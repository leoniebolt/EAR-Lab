lio_sam:

  # ================================================================
  # 1. TOPICS (CRITICAL UPDATES for M2DGR)
  # ================================================================
  pointCloudTopic: "/velodyne_points"      # M2DGR uses /velodyne_points
  imuTopic: "/handsfree/imu"               # M2DGR uses /handsfree/imu
  odomTopic: "odometry/imu"                # IMU pre-preintegration odometry
  gpsTopic: "odometry/gpsz"                # GPS odometry (optional)

  # ================================================================
  # 2. FRAMES
  # ================================================================
  lidarFrame: "velodyne"                   # M2DGR usually uses 'velodyne' frame
  baselinkFrame: "base_link"
  odometryFrame: "odom"
  mapFrame: "map"

  # ================================================================
  # 3. SENSOR SETTINGS (M2DGR uses Velodyne VLP-32C)
  # ================================================================
  sensor: velodyne                         # lidar sensor type
  N_SCAN: 32                               # VLP-32C has 32 channels
  Horizon_SCAN: 1800                       # Standard Velodyne resolution
  downsampleRate: 1                        # 1 = Use all points (10Hz is manageable)
  lidarMinRange: 1.0                       # Filter body reflections
  lidarMaxRange: 1000.0

  # ================================================================
  # 4. IMU SETTINGS (Handsfree A9 9-axis)
  # ================================================================
  # These are standard LIO-SAM defaults. 
  # If you notice drift, increase the GyrNoise/AccNoise slightly for the A9.
  imuAccNoise: 3.7686306102624571e-02
  imuGyrNoise: 2.3417543020438883e-03
  imuAccBiasN: 1.1416642385952368e-03
  imuGyrBiasN: 1.4428407712885209e-05
  imuGravity: 9.80511
  imuRPYWeight: 0.01

  # ================================================================
  # 5. EXTRINSICS (LiDAR -> IMU)
  # ================================================================
  # Values you provided for M2DGR
  extrinsicTrans: [0.27255, -0.00053, 0.17954]
  
  # ROTATION NOTE: M2DGR usually assumes the IMU and LiDAR are aligned.
  # If your map curves like a banana, you may need to rotate this matrix.
  # For now, we use Identity as per your snippet.
  extrinsicRot: [1, 0, 0,
                 0, 1, 0,
                 0, 0, 1]
  extrinsicRPY: [1, 0, 0,
                 0, 1, 0,
                 0, 0, 1]

  # ================================================================
  # 6. GENERAL SLAM SETTINGS
  # ================================================================
  # GPS Settings
  useImuHeadingInitialization: true
  useGpsElevation: false
  gpsCovThreshold: 2.0
  poseCovThreshold: 25.0

  # Export settings
  savePCD: false
  savePCDDirectory: "/home/ubuntu/Downloads/LOAM/" # Updated path to be valid

  # LOAM feature threshold
  edgeThreshold: 1.0
  surfThreshold: 0.1
  edgeFeatureMinValidNum: 10
  surfFeatureMinValidNum: 100

  # Voxel filter params
  odometrySurfLeafSize: 0.4
  mappingCornerLeafSize: 0.2
  mappingSurfLeafSize: 0.4

  # Robot motion constraint
  z_tollerance: 1000
  rotation_tollerance: 1000

  # CPU Params
  numberOfCores: 4
  mappingProcessInterval: 0.15

  # Surrounding map
  surroundingkeyframeAddingDistThreshold: 1.0
  surroundingkeyframeAddingAngleThreshold: 0.2
  surroundingKeyframeDensity: 2.0
  surroundingKeyframeSearchRadius: 50.0

  # Loop closure
  loopClosureEnableFlag: true
  loopClosureFrequency: 1.0
  surroundingKeyframeSize: 50
  historyKeyframeSearchRadius: 15.0
  historyKeyframeSearchTimeDiff: 30.0
  historyKeyframeSearchNum: 25
  historyKeyframeFitnessScore: 0.3

  # Visualization
  globalMapVisualizationSearchRadius: 1000.0
  globalMapVisualizationPoseDensity: 10.0
  globalMapVisualizationLeafSize: 1.0

# ================================================================
# NAVSAT SETTINGS (For GPS integration)
# ================================================================
navsat:
  frequency: 50
  wait_for_datum: false
  delay: 0.0
  magnetic_declination_radians: 0
  yaw_offset: 0
  zero_altitude: true
  broadcast_utm_transform: false
  broadcast_utm_transform_as_parent_frame: false
  publish_filtered_gps: false

ekf_gps:
  publish_tf: false
  map_frame: map
  odom_frame: odom
  base_link_frame: base_link
  world_frame: odom

  frequency: 50
  two_d_mode: false
  sensor_timeout: 0.01
  
  imu0: imu_correct
  imu0_config: [false, false, false,
                true,  true,  true,
                false, false, false,
                false, false, true,
                true,  true,  true]
  imu0_differential: false
  imu0_queue_size: 50 
  imu0_remove_gravitational_acceleration: true

  odom0: odometry/gps
  odom0_config: [true,  true,  true,
                 false, false, false,
                 false, false, false,
                 false, false, false,
                 false, false, false]
  odom0_differential: false
  odom0_queue_size: 10

  process_noise_covariance: [ 1.0,  0,    0,    0,    0,    0,    0,     0,     0,     0,    0,    0,    0,    0,      0,
                               0,    1.0,  0,    0,    0,    0,    0,     0,     0,     0,    0,    0,    0,    0,      0,
                               0,    0,    10.0, 0,    0,    0,    0,     0,     0,     0,    0,    0,    0,    0,      0,
                               0,    0,    0,    0.03, 0,    0,    0,     0,     0,     0,    0,    0,    0,    0,      0,
                               0,    0,    0,    0,    0.03, 0,    0,     0,     0,     0,    0,    0,    0,    0,      0,
                               0,    0,    0,    0,    0,    0.1,  0,     0,     0,     0,    0,    0,    0,    0,      0,
                               0,    0,    0,    0,    0,    0,    0.25,  0,     0,     0,    0,    0,    0,    0,      0,
                               0,    0,    0,    0,    0,    0,    0,     0.25,  0,     0,    0,    0,    0,    0,      0,
                               0,    0,    0,    0,    0,    0,    0,     0,     0.04,  0,    0,    0,    0,    0,      0,
                               0,    0,    0,    0,    0,    0,    0,     0,     0,     0.01, 0,    0,    0,    0,      0,
                               0,    0,    0,    0,    0,    0,    0,     0,     0,     0,    0.01, 0,    0,    0,      0,
                               0,    0,    0,    0,    0,    0,    0,     0,     0,     0,    0,    0.5,  0,    0,      0,
                               0,    0,    0,    0,    0,    0,    0,     0,     0,     0,    0,    0,    0.01, 0,      0,
                               0,    0,    0,    0,    0,    0,    0,     0,     0,     0,    0,    0,    0,    0.01,   0,
                               0,    0,    0,    0,    0,    0,    0,     0,     0,     0,    0,    0,    0,    0,      0.015]